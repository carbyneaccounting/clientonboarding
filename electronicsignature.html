<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create Your Signature</title>

  <style>
    :root{
      --border:#e5e7eb;
      --ink:#0f172a;
      --muted:#475569;
      --accent:#2563eb;
      --accent-soft:#e0e7ff;
      --success:#16a34a;
      --danger:#dc2626;
      --focus:0 0 0 3px rgba(37,99,235,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      padding:0;
      background:transparent;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
    }
    [hidden]{display:none !important;}

    /* HARD WIDTH CAP FOR UI EMBED */
    .shell{
      width:100%;
      max-width:520px;            /* << keeps it narrow */
      margin:0 auto;              /* centers inside parent */
      background:rgba(255,255,255,0.92);
      border:1px solid rgba(0,0,0,0.08);
      border-radius:14px;
      box-shadow:0 10px 24px rgba(0,0,0,0.14);
      overflow:hidden;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(180deg,#ffffff,#f9fafb);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .mark{
      width:30px;
      height:30px;
      border-radius:12px;
      background:linear-gradient(135deg,#2563eb,#60a5fa);
      color:white;
      display:grid;
      place-items:center;
      font-weight:900;
      user-select:none;
      flex:0 0 auto;
      font-size:14px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }

    .title h1{
      margin:0;
      font-size:13px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .title p{
      margin:0;
      font-size:11px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .actions{
      display:flex;
      gap:8px;
      align-items:center;
      flex:0 0 auto;
    }

    .btn{
      appearance:none;
      border:1px solid rgba(0,0,0,0.14);
      background:#fff;
      padding:7px 10px;
      border-radius:12px;
      font-size:12px;
      font-weight:800;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .15s ease, border-color .15s ease, opacity .15s ease;
      color:var(--ink);
      line-height:1;
      white-space:nowrap;
      box-shadow:0 6px 14px rgba(15,23,42,.08);
    }

    .btn:hover{
      box-shadow:0 10px 20px rgba(15,23,42,.10);
      border-color:#c7d2fe;
    }
    .btn:active{transform:translateY(1px)}
    .btn:focus{
      outline:none;
      box-shadow:var(--focus), 0 10px 20px rgba(15,23,42,.10);
      border-color:#c7d2fe;
    }
    .btn.primary{
      background:linear-gradient(180deg,#eef2ff,#fff);
      border-color:#c7d2fe;
      color:#1e3a8a;
    }
    .btn.danger{
      background:linear-gradient(180deg,#fee2e2,#fff);
      border-color:#fecaca;
      color:#7f1d1d;
    }
    .btn:disabled{
      opacity:.5;
      cursor:not-allowed;
      box-shadow:none;
      transform:none;
    }

    .content{
      padding:10px 12px 12px;
      display:flex;
      flex-direction:column; /* always stacked to stay narrow */
      gap:10px;
    }

    .card{
      background:rgba(255,255,255,0.96);
      border:1px solid rgba(0,0,0,0.08);
      border-radius:14px;
      box-shadow:0 10px 22px rgba(0,0,0,0.10);
      padding:10px;
      overflow:hidden;
    }

    .card h2{
      margin:0 0 8px;
      font-size:12px;
      letter-spacing:.2px;
    }

    .tabs{
      display:flex;
      gap:8px;
      margin-bottom:8px;
    }

    .tab{
      appearance:none;
      border:1px solid rgba(0,0,0,0.10);
      background:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      cursor:pointer;
      color:var(--muted);
      transition:background .15s ease, border-color .15s ease, box-shadow .15s ease;
      line-height:1;
    }

    .tab:hover{
      border-color:#c7d2fe;
      box-shadow:0 6px 14px rgba(15,23,42,.08);
    }

    .tab:focus{
      outline:none;
      box-shadow:var(--focus), 0 6px 14px rgba(15,23,42,.08);
      border-color:#c7d2fe;
    }

    .tab[aria-selected="true"]{
      background:var(--accent-soft);
      border-color:#c7d2fe;
      color:#1e3a8a;
    }

    .pad-wrap{
      border:1px solid rgba(0,0,0,0.10);
      border-radius:14px;
      overflow:hidden;
      background:#f8fafc;
    }

    canvas#pad{
      width:100%;
      height:140px;
      background:#fff;
      cursor:crosshair;
      touch-action:none;
      display:block;
    }

    .pad-tools{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:8px 10px;
      border-top:1px solid rgba(0,0,0,0.08);
      background:#f9fafb;
      flex-wrap:wrap;
      font-size:11px;
      color:var(--muted);
    }

    .mini{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    input[type="range"]{
      width:92px;
      accent-color:var(--accent);
    }

    .status{
      font-weight:900;
      font-size:11px;
      line-height:1;
    }
    .status.ok{color:var(--success)}
    .status.warn{color:var(--danger)}

    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:11px;color:var(--muted)}

    input[type="text"]{
      width:100%;
      padding:9px 10px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,0.10);
      font-size:13px;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
      background:#fff;
      color:var(--ink);
    }

    input[type="text"]::placeholder{color:rgba(71,85,105,.55)}

    input[type="text"]:focus{
      border-color:#c7d2fe;
      box-shadow:0 0 0 3px rgba(224,231,255,0.9);
    }

    .row{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:8px;
    }

    .sig-preview{
      border:1px dashed rgba(0,0,0,0.18);
      border-radius:14px;
      min-height:78px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fafafa;
      margin-top:8px;
      padding:10px;
      overflow:hidden;
    }

    .typed-render{
      font-family:"Arial Narrow", Arial, sans-serif;
      font-size:10px;
      font-weight:700;
      white-space:nowrap;
      color:#020617;
      text-align:center;
    }

    .hint{
      font-size:11px;
      color:var(--muted);
      margin-top:8px;
      line-height:1.35;
    }

    .meta{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      margin-top:4px;
    }

    .kv{
      border:1px solid rgba(0,0,0,0.08);
      border-radius:12px;
      padding:8px;
      background:#fff;
    }

    .kv .k{
      font-size:10px;
      color:var(--muted);
      margin-bottom:6px;
    }

    .kv .v{
      font-size:11px;
      font-weight:900;
      line-height:1;
    }

    .adopted{
      margin-top:8px;
      border:1px solid rgba(0,0,0,0.08);
      border-radius:14px;
      background:#fff;
      padding:8px;
    }

    .adopted .k{
      font-size:10px;
      color:var(--muted);
      margin-bottom:6px;
    }

    .adopted-box{
      border:1px dashed rgba(0,0,0,0.18);
      border-radius:12px;
      background:#fafafa;
      height:86px;
      padding:8px;
      overflow:hidden;
      position:relative;
    }

    .adopted-stage{
      position:absolute;
      inset:8px;
      border-radius:10px;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    .adopted-empty{
      font-size:11px;
      color:var(--muted);
      text-align:center;
      padding:0 10px;
    }

    canvas#adoptedCanvas{
      width:100%;
      height:100%;
      display:block;
      background:#fff;
    }

    .adopted-typed{
      width:100%;
      text-align:center;
      font-family:"Arial Narrow", Arial, sans-serif;
      font-size:10px;
      font-weight:700;
      color:#020617;
      white-space:nowrap;
      padding:0 10px;
    }
  </style>
</head>

<body>
  <div class="shell" role="application" aria-label="Signature Creator">
    <header>
      <div class="brand">
        <div class="mark">‚úç</div>
        <div class="title">
          <h1>Create Your Signature</h1>
          <p>Draw or type, then adopt for signing</p>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn danger" id="clearAllBtn">Clear</button>
        <button type="button" class="btn primary" id="adoptBtn" disabled>Adopt</button>
      </div>
    </header>

    <div class="content">
      <section class="card" aria-label="Signature input section">
        <h2>Signature Input</h2>

        <div class="tabs" role="tablist" aria-label="Signature mode">
          <button class="tab" id="tabDraw" role="tab" aria-selected="true" aria-controls="panelDraw">Draw</button>
          <button class="tab" id="tabType" role="tab" aria-selected="false" aria-controls="panelType">Type</button>
        </div>

        <div id="panelDraw" role="tabpanel" aria-labelledby="tabDraw">
          <div class="pad-wrap" aria-label="Signature pad container">
            <canvas id="pad" width="1200" height="420" aria-label="Signature pad"></canvas>

            <div class="pad-tools">
              <div class="mini">
                <span>Stroke <strong id="strokeVal">3</strong></span>
                <input id="stroke" type="range" min="1" max="8" step="1" value="3" aria-label="Stroke width" />
                <span class="status warn" id="drawStatus">Empty</span>
              </div>

              <button type="button" class="btn" id="clearDrawBtn">Clear</button>
            </div>
          </div>

          <div class="hint">Switching modes clears the other mode.</div>
        </div>

        <div id="panelType" role="tabpanel" aria-labelledby="tabType" hidden>
          <div class="field">
            <label for="typedInput">Type your name</label>
            <input id="typedInput" type="text" placeholder="Full Name" autocomplete="off" />
          </div>

          <div class="row">
            <button type="button" class="btn" id="renderTypeBtn">Render</button>
            <span class="status warn" id="typeStatus">Empty</span>
          </div>

          <div class="sig-preview" aria-label="Typed signature preview">
            <div class="typed-render" id="typedRender">/s/ Full Name</div>
          </div>

          <div class="hint">Switching modes clears the other mode.</div>
        </div>
      </section>

      <aside class="card" aria-label="Adoption status section">
        <h2>Adoption Status</h2>

        <div class="meta" aria-label="Status values">
          <div class="kv">
            <div class="k">Mode</div>
            <div class="v" id="statusMode">Draw</div>
          </div>

          <div class="kv">
            <div class="k">Has signature</div>
            <div class="v" id="statusHas">No</div>
          </div>

          <div class="kv">
            <div class="k">Adopt button</div>
            <div class="v" id="statusAdopt">Disabled</div>
          </div>

          <div class="kv">
            <div class="k">Last adopted</div>
            <div class="v" id="statusWhen">None</div>
          </div>
        </div>

        <div class="adopted">
          <div class="k">Adopted signature</div>

          <div class="adopted-box">
            <div class="adopted-stage" id="adoptedStage">
              <div class="adopted-empty" id="adoptedEmpty">No adopted signature</div>
              <canvas id="adoptedCanvas" width="900" height="220" style="display:none;"></canvas>
              <div class="adopted-typed" id="adoptedTyped" style="display:none;"></div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);

    const tabDraw = el("tabDraw");
    const tabType = el("tabType");
    const panelDraw = el("panelDraw");
    const panelType = el("panelType");

    const stroke = el("stroke");
    const strokeVal = el("strokeVal");
    const clearDrawBtn = el("clearDrawBtn");
    const clearAllBtn = el("clearAllBtn");

    const typedInput = el("typedInput");
    const renderTypeBtn = el("renderTypeBtn");
    const typedRender = el("typedRender");

    const adoptBtn = el("adoptBtn");

    const statusMode = el("statusMode");
    const statusHas = el("statusHas");
    const statusAdopt = el("statusAdopt");
    const statusWhen = el("statusWhen");

    const drawStatus = el("drawStatus");
    const typeStatus = el("typeStatus");

    const adoptedEmpty = el("adoptedEmpty");
    const adoptedCanvas = el("adoptedCanvas");
    const adoptedTyped = el("adoptedTyped");

    const canvas = el("pad");
    const ctx = canvas.getContext("2d");

    let mode = "draw";
    let drawing = false;
    let hasDrawInk = false;
    let hasTypeInk = false;
    let lastTypeText = "";

    function setStatusText(node, ok, text){
      node.textContent = text;
      node.classList.remove("ok","warn");
      node.classList.add(ok ? "ok" : "warn");
    }

    function updateAdoptButton(){
      const hasSig = (mode === "draw" && hasDrawInk) || (mode === "type" && hasTypeInk);
      adoptBtn.disabled = !hasSig;
      statusHas.textContent = hasSig ? "Yes" : "No";
      statusAdopt.textContent = hasSig ? "Enabled" : "Disabled";
      statusAdopt.style.color = hasSig ? "var(--success)" : "var(--ink)";
    }

    function setMode(next){
      if (next === mode) return;

      if (next === "draw"){
        clearTypeInternal();
      } else {
        clearDrawInternal();
      }

      mode = next;
      statusMode.textContent = next === "draw" ? "Draw" : "Type";

      const drawSelected = next === "draw";
      tabDraw.setAttribute("aria-selected", drawSelected ? "true" : "false");
      tabType.setAttribute("aria-selected", drawSelected ? "false" : "true");
      panelDraw.hidden = !drawSelected;
      panelType.hidden = drawSelected;

      updateAdoptButton();
    }

    tabDraw.addEventListener("click", () => setMode("draw"));
    tabType.addEventListener("click", () => setMode("type"));

    function fillWhite(c, w, h){
      c.save();
      c.globalCompositeOperation = "source-over";
      c.fillStyle = "#ffffff";
      c.fillRect(0,0,w,h);
      c.restore();
    }

    function resetPad(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      fillWhite(ctx, canvas.width, canvas.height);
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.strokeStyle = "#0f172a";
      ctx.lineWidth = Number(stroke.value);
    }

    resetPad();

    function canvasPoint(e){
      const r = canvas.getBoundingClientRect();
      const touch = e.touches && e.touches[0];
      const cx = touch ? touch.clientX : e.clientX;
      const cy = touch ? touch.clientY : e.clientY;
      return {
        x: (cx - r.left) * canvas.width / r.width,
        y: (cy - r.top) * canvas.height / r.height
      };
    }

    function beginDraw(e){
      if (mode !== "draw") return;
      drawing = true;
      const p = canvasPoint(e);
      ctx.beginPath();
      ctx.moveTo(p.x,p.y);
      e.preventDefault();
    }

    function moveDraw(e){
      if (!drawing || mode !== "draw") return;
      const p = canvasPoint(e);
      ctx.lineTo(p.x,p.y);
      ctx.stroke();
      hasDrawInk = true;
      setStatusText(drawStatus, true, "Ready");
      updateAdoptButton();
      e.preventDefault();
    }

    function endDraw(){
      if (!drawing) return;
      drawing = false;
      ctx.closePath();
    }

    canvas.addEventListener("mousedown", beginDraw);
    canvas.addEventListener("mousemove", moveDraw);
    window.addEventListener("mouseup", endDraw);

    canvas.addEventListener("touchstart", beginDraw, { passive:false });
    canvas.addEventListener("touchmove", moveDraw, { passive:false });
    window.addEventListener("touchend", endDraw);

    stroke.addEventListener("input", () => {
      strokeVal.textContent = stroke.value;
      ctx.lineWidth = Number(stroke.value);
    });

    function clearDrawInternal(){
      resetPad();
      hasDrawInk = false;
      setStatusText(drawStatus, false, "Empty");
      updateAdoptButton();
    }

    clearDrawBtn.addEventListener("click", clearDrawInternal);

    function clearTypeInternal(){
      typedInput.value = "";
      hasTypeInk = false;
      lastTypeText = "";
      typedRender.textContent = "/s/ Full Name";
      setStatusText(typeStatus, false, "Empty");
      updateAdoptButton();
    }

    function renderTyped(){
      const v = (typedInput.value || "").trim();
      if (!v){
        hasTypeInk = false;
        lastTypeText = "";
        setStatusText(typeStatus, false, "Empty");
        typedRender.textContent = "/s/ Full Name";
        updateAdoptButton();
        return;
      }

      hasTypeInk = true;
      lastTypeText = v;
      setStatusText(typeStatus, true, "Ready");
      typedRender.textContent = `/s/ ${v}`;
      updateAdoptButton();
    }

    renderTypeBtn.addEventListener("click", renderTyped);
    typedInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") renderTyped();
    });

    function clearAdopted(){
      adoptedCanvas.style.display = "none";
      adoptedTyped.style.display = "none";
      adoptedEmpty.style.display = "block";
      adoptedEmpty.textContent = "No adopted signature";
      statusWhen.textContent = "None";
    }

    function stampWhen(){
      const d = new Date();
      const pad2 = (n) => String(n).padStart(2,"0");
      const stamp = `${pad2(d.getMonth()+1)}/${pad2(d.getDate())}/${d.getFullYear()} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
      statusWhen.textContent = stamp;
    }

    function getInkBoundingBox(srcCanvas){
      const sctx = srcCanvas.getContext("2d");
      const { width:w, height:h } = srcCanvas;
      const img = sctx.getImageData(0,0,w,h).data;

      let minX = w, minY = h, maxX = 0, maxY = 0;
      let found = false;

      for (let y=0; y<h; y++){
        for (let x=0; x<w; x++){
          const i = (y*w + x) * 4;
          const r = img[i], g = img[i+1], b = img[i+2], a = img[i+3];
          if (a === 0) continue;
          if (r > 245 && g > 245 && b > 245) continue;

          found = true;
          if (x < minX) minX = x;
          if (y < minY) minY = y;
          if (x > maxX) maxX = x;
          if (y > maxY) maxY = y;
        }
      }

      if (!found) return null;
      return { x:minX, y:minY, w:(maxX-minX+1), h:(maxY-minY+1) };
    }

    function drawCroppedTo(dstCtx, srcCanvas, dstW, dstH){
      dstCtx.clearRect(0,0,dstW,dstH);
      dstCtx.fillStyle = "#ffffff";
      dstCtx.fillRect(0,0,dstW,dstH);

      const bbox = getInkBoundingBox(srcCanvas);
      if (!bbox) return false;

      const padding = 10;
      const availW = Math.max(1, dstW - padding * 2);
      const availH = Math.max(1, dstH - padding * 2);

      const scale = Math.min(availW / bbox.w, availH / bbox.h);
      const drawW = bbox.w * scale;
      const drawH = bbox.h * scale;

      const dx = (dstW - drawW) / 2;
      const dy = (dstH - drawH) / 2;

      dstCtx.drawImage(
        srcCanvas,
        bbox.x, bbox.y, bbox.w, bbox.h,
        dx, dy, drawW, drawH
      );
      return true;
    }

    function adoptCurrent(){
      clearAdopted();

      if (mode === "draw"){
        if (!hasDrawInk) return;

        adoptedEmpty.style.display = "none";
        adoptedTyped.style.display = "none";
        adoptedCanvas.style.display = "block";

        const dctx = adoptedCanvas.getContext("2d");
        drawCroppedTo(dctx, canvas, adoptedCanvas.width, adoptedCanvas.height);
        stampWhen();
        return;
      }

      if (mode === "type"){
        if (!hasTypeInk || !lastTypeText) return;

        adoptedEmpty.style.display = "none";
        adoptedCanvas.style.display = "none";
        adoptedTyped.style.display = "block";
        adoptedTyped.textContent = `/s/ ${lastTypeText}`;
        stampWhen();
        return;
      }
    }

    adoptBtn.addEventListener("click", adoptCurrent);

    function clearAll(){
      clearDrawInternal();
      clearTypeInternal();
      clearAdopted();
      setMode("draw");
      updateAdoptButton();
    }

    function initDefaultStates(){
      strokeVal.textContent = stroke.value;
      setStatusText(drawStatus, false, "Empty");
      setStatusText(typeStatus, false, "Empty");
      clearAdopted();
      updateAdoptButton();
    }

    clearAllBtn.addEventListener("click", clearAll);

    initDefaultStates();
  </script>
</body>
</html>
