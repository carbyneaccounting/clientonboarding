<!-- validate.html - INSTANT VALIDATION WITH CODES.JS -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Validate Access Code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="codes.js"></script>
</head>
<body>
  <script>
    (function() {
      function normalize(v) {
        return (v ?? "").toString().trim();
      }

      function getCode() {
        const hash = (location.hash || "").replace(/^#/, "");
        const params = new URLSearchParams(hash);
        return normalize(params.get("code") || "");
      }

      function postResult(valid, code) {
        const payload = {
          type: "carbyne-validate",
          valid: !!valid,
          code: code || ""
        };

        try {
          if (window.parent && window.parent !== window) {
            window.parent.postMessage(payload, "*");
          }
          if (window.opener) {
            window.opener.postMessage(payload, "*");
          }
        } catch (e) {
          console.error("Failed to post message:", e);
        }

        document.body.textContent = valid ? "Valid" : "Invalid";
      }

      function validate() {
        const code = getCode();

        if (!code) {
          postResult(false, "");
          return;
        }

        // Get valid codes from codes.js
        const validCodes = window.CARBYNE_VALID_CODES || [];

        // Fast case-insensitive lookup
        const needle = code.toLowerCase();
        const isValid = validCodes.some(validCode => 
          validCode.toLowerCase() === needle
        );

        postResult(isValid, code);
      }

      // Run validation immediately - INSTANT!
      validate();
    })();
  </script>
</body>
</html>
