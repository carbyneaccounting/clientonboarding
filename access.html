<!-- access.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Access</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div id="accessModule">
    <style>
      :root{
        --carbyne-blue:#00305B;
        --carbyne-blue-2:#0A3D6F;
        --danger:#b91c1c;
      }

      .access-shell{
        width:min(740px, 92%);
        padding:2px;
        border-radius:22px;
        background:linear-gradient(135deg, var(--carbyne-blue) 0%, var(--carbyne-blue-2) 50%, var(--carbyne-blue) 100%);
        box-shadow:0 28px 64px rgba(0,0,0,0.28);
      }

      .access-card{
        background:rgba(255,255,255,0.92);
        border:1px solid rgba(0,0,0,0.06);
        border-radius:20px;
        padding:30px 30px 26px 30px;
      }

      .access-title{
        font-size:18px;
        font-weight:800;
        color:#111827;
        margin:0 0 14px 0;
        text-align:left;
      }

      .access-label{
        font-size:13px;
        font-weight:800;
        color:#334155;
        margin:0 0 8px 0;
        text-align:left;
        letter-spacing:.2px;
      }

      .access-input{
        width:100%;
        padding:14px 16px;
        font-size:15px;
        border:1px solid rgba(0,0,0,0.18);
        border-radius:12px;
        outline:none;
        margin:0 0 16px 0;
        background:#ffffff;
      }

      .access-input:focus{
        border-color:rgba(0,48,91,0.75);
        box-shadow:0 0 0 3px rgba(0,48,91,0.18);
      }

      .access-row{
        display:flex;
        gap:12px;
        align-items:center;
        justify-content:flex-start;
        flex-wrap:wrap;
      }

      .access-submit{
        padding:11px 22px;
        font-size:14px;
        font-weight:800;
        border-radius:10px;
        border:1px solid rgba(0,0,0,0.10);
        background:linear-gradient(90deg, var(--carbyne-blue) 0%, var(--carbyne-blue-2) 100%);
        color:#ffffff;
        cursor:pointer;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        min-width:132px;
        box-shadow:0 10px 20px rgba(0,0,0,0.14);
      }

      .access-submit:hover{ opacity:.95; }
      .access-submit:disabled{ opacity:.6; cursor:not-allowed; box-shadow:none; }

      .inline-msg{
        font-size:13px;
        font-weight:800;
        letter-spacing:.2px;
        display:none;
        white-space:nowrap;
        color:var(--danger);
      }

      .sr-only{
        position:absolute;
        width:1px;
        height:1px;
        padding:0;
        margin:-1px;
        overflow:hidden;
        clip:rect(0,0,0,0);
        white-space:nowrap;
        border:0;
      }
    </style>

    <div class="access-shell">
      <div class="access-card">
        <div class="access-title">Enter Access Code</div>

        <div class="access-label">Unique Identifier</div>
        <input
          type="text"
          class="access-input"
          id="accessCode"
          placeholder="Enter your Unique Identifier"
          autocomplete="off"
        >

        <div class="access-row">
          <button type="button" class="access-submit" id="submitCode">Submit</button>
          <span class="inline-msg" id="inlineMsg">Invalid Access Code</span>
        </div>

        <iframe id="validatorFrame" class="sr-only" title="validator"></iframe>
      </div>
    </div>

    <script>
      (function(){
        const STORAGE_KEY = "carbyne_access_code";
        const VALIDATOR_URL = "validate.html";
        const NEXT_PAGE_URL = "index.html";

        const input = document.getElementById("accessCode");
        const btn   = document.getElementById("submitCode");
        const msg   = document.getElementById("inlineMsg");
        const frame = document.getElementById("validatorFrame");

        function normalize(v){ return (v ?? "").toString().trim(); }

        function showInvalid(show){
          msg.style.display = show ? "inline" : "none";
        }

        function setBusy(isBusy){
          btn.disabled = !!isBusy;
        }

        function submit(){
          showInvalid(false);

          const code = normalize(input.value);
          input.value = code;

          if (!code){
            showInvalid(true);
            return;
          }

          setBusy(true);
          const src = VALIDATOR_URL + "#code=" + encodeURIComponent(code) + "&t=" + Date.now();
          frame.src = src;
        }

        window.addEventListener("message", (ev) => {
          const d = ev.data;
          if (!d || d.type !== "carbyne-validate") return;

          setBusy(false);

          if (d.valid === true){
            const finalCode = normalize(d.code || input.value);
            localStorage.setItem(STORAGE_KEY, finalCode);
            showInvalid(false);
            window.location.href = NEXT_PAGE_URL;
            return;
          }

          showInvalid(true);
        });

        btn.addEventListener("click", submit);
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") submit();
        });

        const existing = localStorage.getItem(STORAGE_KEY);
        if (existing) input.value = normalize(existing);

        showInvalid(false);
        input.focus();
      })();
    </script>
  </div>
</body>
</html>
