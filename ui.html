<!-- ui.html - UPDATED WITH EMBEDDED ACCESS MODULE -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Client Onboarding - Carbyne Accounting</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.cdnfonts.com/css/baron" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --carbyne-blue: #00305B;
      --carbyne-blue-2: #0A3D6F;
      --radius: 18px;
      --shadow: 0 28px 56px rgba(0, 0, 0, 0.30);
      --danger: #b91c1c;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      background: linear-gradient(135deg, var(--carbyne-blue) 0%, var(--carbyne-blue-2) 50%, var(--carbyne-blue) 100%);
      position: relative;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .top-left-info {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #ffffff;
      z-index: 10;
    }

    .company-name {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .address {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.2px;
      line-height: 1.35;
      opacity: 0.98;
    }

    .container {
      width: min(1200px, 95vw);
      display: flex;
      flex-direction: column;
    }

    h1 {
      font-family: 'Baron', sans-serif;
      font-size: 22px;
      color: #ffffff;
      font-weight: normal;
      margin-bottom: 14px;
    }

    .card {
      width: 100%;
      height: clamp(520px, 72vh, 860px);
      background: #ffffff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .top-section {
      padding: 18px 30px;
      border-bottom: 1px solid #e6e6e6;
      background: #ffffff;
      z-index: 2;
    }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: #dedede;
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--carbyne-blue) 0%, var(--carbyne-blue-2) 100%);
      border-radius: 999px;
      transition: width 0.25s ease;
    }

    .middle-section {
      flex: 1;
      padding: 26px 30px;
      overflow: auto;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0.52) 0%, rgba(0, 0, 0, 0.42) 45%, rgba(0, 0, 0, 0.52) 100%),
        url("https://images.unsplash.com/photo-1519681393784-d120267933ba");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
    }

    #pageMount {
      width: 100%;
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .bottom-section {
      padding: 18px 30px;
      border-top: 1px solid #e6e6e6;
      background: #ffffff;
      z-index: 2;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .nav-button {
      padding: 10px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: opacity 0.15s ease, transform 0.15s ease;
    }

    .nav-button.previous {
      background: #f0f0f0;
      color: #333;
    }

    .nav-button.previous:hover:not(:disabled) {
      opacity: 0.95;
      transform: translateY(-1px);
    }

    .nav-button.next {
      background: linear-gradient(90deg, var(--carbyne-blue) 0%, var(--carbyne-blue-2) 100%);
      color: #ffffff;
    }

    .nav-button.next:hover:not(:disabled) {
      opacity: 0.95;
      transform: translateY(-1px);
    }

    .nav-button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      transform: none;
    }

    .page-indicator {
      font-size: 14px;
      color: #666;
      font-weight: 600;
    }

    .footer {
      position: absolute;
      bottom: 20px;
      left: 20px;
      color: #ffffff;
      font-size: 13px;
      font-weight: 600;
      opacity: 0.95;
      z-index: 10;
    }

    /* Access Module Styles */
    .access-shell {
      width: min(740px, 92%);
      padding: 2px;
      border-radius: 22px;
      background: linear-gradient(135deg, var(--carbyne-blue) 0%, var(--carbyne-blue-2) 50%, var(--carbyne-blue) 100%);
      box-shadow: 0 28px 64px rgba(0, 0, 0, 0.28);
    }

    .access-card {
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 20px;
      padding: 30px 30px 26px 30px;
    }

    .access-title {
      font-size: 18px;
      font-weight: 800;
      color: #111827;
      margin: 0 0 14px 0;
      text-align: left;
    }

    .access-label {
      font-size: 13px;
      font-weight: 800;
      color: #334155;
      margin: 0 0 8px 0;
      text-align: left;
      letter-spacing: 0.2px;
    }

    .access-input {
      width: 100%;
      padding: 14px 16px;
      font-size: 15px;
      border: 1px solid rgba(0, 0, 0, 0.18);
      border-radius: 12px;
      outline: none;
      margin: 0 0 16px 0;
      background: #ffffff;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .access-input:focus {
      border-color: rgba(0, 48, 91, 0.75);
      box-shadow: 0 0 0 3px rgba(0, 48, 91, 0.18);
    }

    .access-input.error {
      border-color: var(--danger);
    }

    .access-row {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .access-submit {
      padding: 11px 22px;
      font-size: 14px;
      font-weight: 800;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.10);
      background: linear-gradient(90deg, var(--carbyne-blue) 0%, var(--carbyne-blue-2) 100%);
      color: #ffffff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 132px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.14);
      transition: opacity 0.2s ease, box-shadow 0.2s ease;
    }

    .access-submit:hover:not(:disabled) {
      opacity: 0.95;
    }

    .access-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .inline-msg {
      font-size: 13px;
      font-weight: 800;
      letter-spacing: 0.2px;
      display: none;
      white-space: nowrap;
      color: var(--danger);
    }

    .inline-msg.show {
      display: inline;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Page 2+ styling */
    .page-content {
      width: min(740px, 92%);
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 14px;
      padding: 30px;
      color: #111827;
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.18);
    }

    .page-content h2 {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 16px;
      color: var(--carbyne-blue);
    }

    .page-content p {
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 12px;
    }
  </style>
</head>

<body>
  <div class="top-left-info">
    <div class="company-name">Carbyne Accounting</div>
    <div class="address">
      734 West Main Street, Suite 106<br>
      Louisville, Kentucky 40202<br>
      (502) 632-9444 | Client@CarbyneAccounting.com
    </div>
  </div>

  <div class="container">
    <h1>Client Onboarding</h1>

    <div class="card">
      <div class="top-section">
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progressBar"></div>
        </div>
      </div>

      <div class="middle-section">
        <div id="pageMount"></div>
      </div>

      <div class="bottom-section">
        <div class="navigation">
          <button class="nav-button previous" id="prevBtn">Previous</button>
          <span class="page-indicator" id="pageIndicator">Step 1 of 5</span>
          <button class="nav-button next" id="nextBtn">Next</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">Carbyne Accountingâ„¢ - Confidential &amp; Proprietary System</div>

  <script>
    // Configuration
    const TOTAL_PAGES = 5;
    const STORAGE_KEY = "carbyne_access_code";
    const CURRENT_PAGE_KEY = "carbyne_current_page";
    const VALIDATOR_URL = "validate.html";

    // State
    let currentPage = 1;
    let isAccessValidated = false;

    // Elements
    const pageMount = document.getElementById("pageMount");
    const progressBar = document.getElementById("progressBar");
    const pageIndicator = document.getElementById("pageIndicator");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    // Initialize
    function init() {
      // Check if access code exists
      const accessCode = localStorage.getItem(STORAGE_KEY);
      isAccessValidated = !!accessCode;

      // Get saved page or start at 1
      const savedPage = parseInt(localStorage.getItem(CURRENT_PAGE_KEY)) || 1;
      currentPage = isAccessValidated ? savedPage : 1;

      // Listen for validation success
      window.addEventListener("message", handleValidationMessage);

      // Load current page
      loadPage(currentPage);

      // Setup navigation
      prevBtn.addEventListener("click", goToPreviousPage);
      nextBtn.addEventListener("click", goToNextPage);
    }

    function handleValidationMessage(event) {
      const data = event.data;
      if (!data || data.type !== "carbyne-validate") return;

      if (data.valid === true) {
        isAccessValidated = true;
        goToNextPage();
      }
    }

    function updateUI() {
      // Update progress bar
      const progress = (currentPage / TOTAL_PAGES) * 100;
      progressBar.style.width = `${progress}%`;

      // Update page indicator
      pageIndicator.textContent = `Step ${currentPage} of ${TOTAL_PAGES}`;

      // Update button states
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === TOTAL_PAGES;

      // Save current page
      localStorage.setItem(CURRENT_PAGE_KEY, currentPage);
    }

    function goToPreviousPage() {
      if (currentPage > 1) {
        currentPage--;
        loadPage(currentPage);
      }
    }

    function goToNextPage() {
      if (currentPage < TOTAL_PAGES) {
        currentPage++;
        loadPage(currentPage);
      }
    }

    function loadPage(pageNum) {
      pageMount.innerHTML = "";
      updateUI();

      if (pageNum === 1) {
        // Load access module (embedded)
        loadAccessModule();
      } else {
        // Check if access is validated
        if (!isAccessValidated) {
          currentPage = 1;
          loadAccessModule();
          return;
        }

        // Load page content
        loadPageContent(pageNum);
      }
    }

    function loadAccessModule() {
      const accessHTML = `
        <div class="access-shell">
          <div class="access-card">
            <div class="access-title">Enter Access Code</div>

            <div class="access-label">Unique Identifier</div>
            <input
              type="text"
              class="access-input"
              id="accessCode"
              placeholder="Enter your Unique Identifier"
              autocomplete="off"
              aria-label="Unique Identifier"
            >

            <div class="access-row">
              <button type="button" class="access-submit" id="submitCode">
                <span id="btnText">Submit</span>
              </button>
              <span class="inline-msg" id="inlineMsg">Invalid Access Code</span>
            </div>

            <iframe id="validatorFrame" class="sr-only" title="validator" aria-hidden="true"></iframe>
          </div>
        </div>
      `;

      pageMount.innerHTML = accessHTML;
      initAccessModule();
    }

    function initAccessModule() {
      const input = document.getElementById("accessCode");
      const btn = document.getElementById("submitCode");
      const btnText = document.getElementById("btnText");
      const msg = document.getElementById("inlineMsg");
      const frame = document.getElementById("validatorFrame");

      function normalize(v) {
        return (v ?? "").toString().trim();
      }

      function showInvalid(show) {
        if (show) {
          msg.classList.add("show");
          input.classList.add("error");
        } else {
          msg.classList.remove("show");
          input.classList.remove("error");
        }
      }

      function setBusy(isBusy) {
        btn.disabled = !!isBusy;
        if (isBusy) {
          btnText.innerHTML = '<span class="spinner"></span>';
        } else {
          btnText.textContent = "Submit";
        }
      }

      function submit() {
        showInvalid(false);

        const code = normalize(input.value);
        input.value = code;

        if (!code) {
          showInvalid(true);
          msg.textContent = "Please enter a code";
          return;
        }

        setBusy(true);
        msg.textContent = "Invalid Access Code";

        // Load validator with code
        const src = VALIDATOR_URL + "#code=" + encodeURIComponent(code) + "&t=" + Date.now();
        frame.src = src;
      }

      // Listen for validation response
      window.addEventListener("message", (ev) => {
        const d = ev.data;
        if (!d || d.type !== "carbyne-validate") return;

        setBusy(false);

        if (d.valid === true) {
          const finalCode = normalize(d.code || input.value);
          localStorage.setItem(STORAGE_KEY, finalCode);
          showInvalid(false);
          isAccessValidated = true;
          goToNextPage();
          return;
        }

        showInvalid(true);
      });

      // Event listeners
      btn.addEventListener("click", submit);
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") submit();
      });

      // Initialize
      const existing = localStorage.getItem(STORAGE_KEY);
      if (existing) {
        input.value = normalize(existing);
      }

      showInvalid(false);
      input.focus();
    }

    function loadPageContent(pageNum) {
      const content = document.createElement("div");
      content.className = "page-content";

      switch (pageNum) {
        case 2:
          content.innerHTML = `
            <h2>Welcome to Step 2</h2>
            <p>This is the second step of the onboarding process.</p>
            <p>Add your content here for page 2.</p>
          `;
          break;
        case 3:
          content.innerHTML = `
            <h2>Welcome to Step 3</h2>
            <p>This is the third step of the onboarding process.</p>
            <p>Add your content here for page 3.</p>
          `;
          break;
        case 4:
          content.innerHTML = `
            <h2>Welcome to Step 4</h2>
            <p>This is the fourth step of the onboarding process.</p>
            <p>Add your content here for page 4.</p>
          `;
          break;
        case 5:
          content.innerHTML = `
            <h2>Welcome to Step 5</h2>
            <p>This is the final step of the onboarding process.</p>
            <p>Add your content here for page 5.</p>
          `;
          break;
        default:
          content.innerHTML = `
            <h2>Page ${pageNum}</h2>
            <p>Content for page ${pageNum} goes here.</p>
          `;
      }

      pageMount.appendChild(content);
    }

    // Start the application
    init();
  </script>
</body>
</html>
