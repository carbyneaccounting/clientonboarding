<!-- clientintakeform.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Client Intake Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<template id="carbyne_client_intake">
  <style>
    .ci-wrap{
      width:100%;
      max-width:980px;
    }

    .ci-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      padding:4px 2px 0;
    }

    .ci-h2{
      margin:0;
      font-size:28px;
      font-weight:950;
      color:#0b2f4e;
      letter-spacing:.2px;
    }

    .ci-section{
      margin-top:12px;
      font-size:14px;
      font-weight:950;
      color:#0f172a;
      letter-spacing:.2px;
    }

    .ci-spacer{height:10px}

    .ci-grid{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:14px;
      margin-top:10px;
    }

    .ci-field{width:100%}

    .ci-labelrow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin:0 0 8px;
    }

    .ci-label{
      font-size:13px;
      font-weight:950;
      color:#0f172a;
      opacity:.92;
    }

    .ci-inline{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      font-weight:950;
      color:#0f172a;
      opacity:.85;
      white-space:nowrap;
    }

    .ci-check{
      width:16px;height:16px;
      accent-color:#00305B;
      cursor:pointer;
    }

    .ci-input, .ci-select{
      width:100%;
      border:1px solid rgba(0,0,0,.14);
      border-radius:14px;
      padding:14px 16px;
      font-size:14px;
      font-weight:900;
      outline:none;
      background:#fff;
      box-shadow:0 10px 20px rgba(2,6,23,.08);
      transition:border-color .18s ease, box-shadow .18s ease, background-color .18s ease;
      color:#0f172a;
    }

    .ci-input::placeholder{color:#64748b;font-weight:900;opacity:.75}

    .ci-input:focus, .ci-select:focus{
      border-color:rgba(0,48,91,.70);
      box-shadow:0 0 0 3px rgba(0,48,91,.16), 0 12px 24px rgba(2,6,23,.10);
    }

    .ci-input[disabled]{
      background:#f1f5f9;
      color:#64748b;
      box-shadow:none;
      cursor:not-allowed;
    }

    .ci-wide{grid-column:1 / -1}

    /* Basis of Accounting */
    .ci-basis-row{
      display:flex;
      align-items:center;
      gap:16px;
      flex-wrap:wrap;
      margin-top:10px;
      padding:2px 2px 0;
    }

    .ci-radio{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:13px;
      font-weight:950;
      color:#0f172a;
      opacity:.92;
      white-space:nowrap;
      user-select:none;
    }

    .ci-radio input[type="radio"]{
      width:16px;height:16px;
      accent-color:#00305B;
      cursor:pointer;
    }

    .ci-other-wrap{
      display:inline-flex;
      align-items:center;
      gap:10px;
    }

    .ci-other-input{
      width:280px;
    }

    @media (max-width:820px){
      .ci-grid{grid-template-columns:1fr}
      .ci-other-input{width:100%}
    }
  </style>

  <div class="ci-wrap" id="ciRoot">
    <div class="ci-top">
      <h2 class="ci-h2">Client Intake Form</h2>
      <div></div>
    </div>

    <div class="ci-spacer"></div>

    <div class="ci-section">Business Information</div>

    <div class="ci-grid">
      <div class="ci-field">
        <div class="ci-labelrow">
          <div class="ci-label">Name of Business</div>
        </div>
        <input class="ci-input" id="bi_name" type="text" placeholder="Name of Business">
      </div>

      <div class="ci-field">
        <div class="ci-labelrow">
          <div class="ci-label">Federal Employer Identification Number (FEIN)</div>
          <label class="ci-inline">
            <input class="ci-check" id="bi_no_fein" type="checkbox">
            No FEIN
          </label>
        </div>
        <input class="ci-input" id="bi_fein" type="text" placeholder="XX-XXXXXXX" maxlength="10">
      </div>
    </div>

    <!-- existing business info continues unchanged -->

    <div class="ci-section" style="margin-top:18px;">Basis of Accounting</div>

    <div class="ci-basis-row">
      <label class="ci-radio">
        <input type="radio" name="boa_basis" value="Accrual Basis">
        Accrual Basis
      </label>

      <label class="ci-radio">
        <input type="radio" name="boa_basis" value="Cash Basis">
        Cash Basis
      </label>

      <label class="ci-radio">
        <input type="radio" name="boa_basis" value="Mixed Method">
        Mixed Method
      </label>

      <div class="ci-other-wrap">
        <label class="ci-radio">
          <input type="radio" name="boa_basis" id="boa_other" value="Other">
          Other
        </label>
        <input
          class="ci-input ci-other-input"
          id="boa_other_text"
          type="text"
          placeholder="Specify"
          disabled
        >
      </div>
    </div>
  </div>
</template>

<script>
(function(){
  const STORAGE_KEY_INTAKE = "carbyne_intake_business_info";

  function loadSaved(root){
    try{
      const raw = localStorage.getItem(STORAGE_KEY_INTAKE);
      if (!raw) return;
      const data = JSON.parse(raw);

      Object.keys(data).forEach(k=>{
        const el = root.querySelector("#"+k);
        if (!el) return;
        if (el.type === "radio"){
          el.checked = el.value === data[k];
        } else {
          el.value = data[k];
        }
      });
    } catch {}
  }

  function save(root){
    const out = {};
    root.querySelectorAll("input,select").forEach(el=>{
      if (el.type === "radio"){
        if (el.checked) out[el.name] = el.value;
      } else {
        out[el.id] = el.value || "";
      }
    });
    try{ localStorage.setItem(STORAGE_KEY_INTAKE, JSON.stringify(out)); } catch {}
  }

  window.carbyne_client_intake_mount = function({ root }){
    const radios = Array.from(root.querySelectorAll('input[name="boa_basis"]'));
    const otherRadio = root.querySelector("#boa_other");
    const otherInput = root.querySelector("#boa_other_text");

    function syncOther(){
      const active = otherRadio.checked;
      otherInput.disabled = !active;
      if (!active) otherInput.value = "";
      save(root);
    }

    loadSaved(root);
    syncOther();

    radios.forEach(r => r.addEventListener("change", syncOther));
    otherInput.addEventListener("input", ()=>save(root));

    return function unmount(){
      radios.forEach(r => r.removeEventListener("change", syncOther));
    };
  };
})();
</script>

</body>
</html>
